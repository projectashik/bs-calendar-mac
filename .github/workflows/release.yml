name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    name: Build macOS App
    runs-on: macos-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Build
        run: |
          xcodebuild -project bs-calendar.xcodeproj \
                     -scheme bs-calendar \
                     -configuration Release \
                     -derivedDataPath build \
                     CODE_SIGN_IDENTITY="" \
                     CODE_SIGNING_REQUIRED=NO
      
      - name: Package
        run: |
          cd build/Build/Products/Release
          zip -r ../../../../bs-calendar-macos.zip bs-calendar.app
      
      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          files: bs-calendar-macos.zip
          tag_name: ${{ github.ref_name || 'v1.0.0' }}
          name: BS Calendar ${{ github.ref_name || 'v1.0.0' }}
          body: |
            ## ðŸ“¥ Download
            
            **File:** `bs-calendar-macos.zip` (~500KB)
            
            ## ðŸš€ Install
            1. Download `bs-calendar-macos.zip`
            2. Extract the ZIP file
            3. Move `bs-calendar.app` to Applications folder
            4. Right-click app â†’ Open (first time only)
            
            ## âœ¨ Features
            - Menu bar Nepali calendar
            - Nepali numerals support (à¥¦à¥§à¥¨à¥©)
            - Light/Dark theme
            - Launch at login
            
            ## ðŸ“‹ Requirements
            macOS 13.0 or later
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
