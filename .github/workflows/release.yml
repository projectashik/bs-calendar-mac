name: Build and Release

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

jobs:
  build:
    name: Build macOS App
    runs-on: macos-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Build
        run: |
          xcodebuild -project bs-calendar.xcodeproj \
                     -scheme bs-calendar \
                     -configuration Release \
                     -derivedDataPath build \
                     CODE_SIGN_IDENTITY="" \
                     CODE_SIGNING_REQUIRED=NO
      
      - name: Package
        run: |
          cd build/Build/Products/Release
          zip -r ../../../../bs-calendar-macos.zip bs-calendar.app
      
      - name: Release
        uses: softprops/action-gh-release@v2
        if: startsWith(github.ref, 'refs/tags/')
        with:
          files: bs-calendar-macos.zip
          body: |
            ## Install
            1. Download `bs-calendar-macos.zip`
            2. Extract and move `bs-calendar.app` to Applications
            3. Right-click app â†’ Open (first time only)
            
            ## Requirements
            macOS 13.0+
